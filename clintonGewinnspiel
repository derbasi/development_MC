<script runat="server" type="text/javascript">
Platform.Load("Core","1.1")

/* get voucher information*/
var couponCodeDE = 'couponTest'
var process = 'testing'
var discount = 7
var amount = 5
var code = ''
var minTotal = ''
var validDays = 30
var type = 'percent'
var voucherName = 'Testgutschein'

/* define API settings */
var url = 'https://www.campdavid-soccx.de/APIs/shop/register/voucher/create/'
var contentType = 'application/json';
var headerNames = ["Authorization"];
var headerValues = ["Bearer " + "t67dgh54j6074t8f4gzj6ho68wo5p645nbw45z0tfd8kuzgu50zg5u6hwjlh8b6vmv4z54"];

var payload = {
  "vouchername": voucherName,
  "validdays": validDays,
  "discount": discount,
  "type": type,
  "amount": amount,
  "code": codeName,
  "mintotal": minTotal
  };

try {

  var result = HTTP.Post(url, contentType, Stringify(payload), headerNames, headerValues);
  Write('<br>responseStr: ' + Stringify(result) + '<br>');

    var resultJSON = Platform.Function.ParseJSON(String(result.Response));
    Write('<br>responseStr: ' + Stringify(resultJSON) + '<br>');
    var codes = Platform.Function.ParseJSON(String(resultJSON.vouchercodes));
    Write('<br>codes: ' + Stringify(codes) + '<br>');

    var myarray = codes.split(',')
    for(var i = 0; i < myarray.length; i++) {
      var singleVoucherCode = myarray[i]
      Write('<br>' + myarray[i]);

      var addRow = Platform.Function.InsertData(couponCodeDE,
        ['subscriberKey', 'voucherCode', 'process'],
        [GUID(), singleVoucherCode, process]
        );
    };
};
catch (err);
{
  Write('err ' + Stringify(err));
};

</script>
