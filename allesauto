%%[
  /* set variables */
  // set @response = AttributeValue('response')
  set @response = 'true'
  // set @marketingAction = AttributeValue('ma')
  set @marketingAction = 'MA00000024'
  // set @subscriberKey = _subscriberKey
  set @subscriberKey = 'testSHfeedback'
  set @email = 'sebastian.heilmeier+feedbackDoneTest@fluentcx.com'
  set @caseId = 'tbd001'
  set @deForInsert = 'ent.LIVE_affinities'
  set @affinityKey = Concat(@marketingAction,'Responded__sfmc') 
  set @submissionSetKey = GUID()
  set @affinityState = 'active'
  set @businessUnit = '536001604'
  set @errorLogDE = 'feedbackErrorLog'
  set @parentBU = '536001490'
  set @cxConfigDE = 'ent.cxConfig'
  
  if not empty(@subscriberKey) and not empty(@marketingAction) then
    /* save answer in affinities */
    set @insertIntoAffinities = UpsertData(@deForInsert,1,'subscriberKey',@subscriberKey,'affinityKey',@affinityKey,'affinitySource',@marketingAction,'affinityState',@affinityState,'affinityValue',@response,'submissionSetKey',@submissionSetKey)
  
    set @eventDefinitionKey = lookup('ent.cxSwitcher','textContent','businessUnit',@businessUnit,'context','de_DE','textClass',@marketingAction,'textSubClass',@response,'textId','eventDefinitionKey')

  endif
  /* trigger feedback mail with ssjs */

    SET @restEndpoint = Lookup(@cxConfigDE,'parameterValue','parameterContext',@parentBU,'parameterName','restEndpoint')


  
]%%
response: %%=v(@response)=%%
<br>getTitleFromMA: %%=v(@getTitleFromMA)=%%
<br>titleBaseName: %%=v(@titleBaseName)=%%
<br>eventDefinitionKey: %%=v(@eventDefinitionKey)=%%
<br>error: %%=v(@error)=%%
<br>restEndpoint: %%=v(@restEndpoint)=%%


<script runat="server" type="text/javascript">

  Platform.Load("Core","1");
  var eventDefinitionKey = Variable.GetValue("@eventDefinitionKey");
  var restEndpoint = Variable.GetValue("@restEndpoint");
  var subscriberKey = Variable.GetValue("@subscriberKey");
  var email = Variable.GetValue("@email");
  var caseId = Variable.GetValue("@caseId");
  var log = Variable.GetValue("@errorLogDE");
  var logDE = DataExtension.Init(log);
  logDE.Rows.Add({errormsg: "variables: " + "eventDefinitionKey: " + eventDefinitionKey + "| restEndpoint: " + restEndpoint + "| subscriberKey: " + subscriberKey + "| email: " email});
  
</script>